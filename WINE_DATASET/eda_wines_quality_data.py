# -*- coding: utf-8 -*-
"""EDA_wines_quality_data.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Iy3mQDQvw116Qe10VGAQg1DQbuqIqgpH
"""

#import the files required
from google.colab import files
import io
uploaded =files.upload()
for fn in uploaded.keys():
   print('User uploaded file "{name}" with length {length} bytes'.format(name=fn, length=len(uploaded[fn])))

#wine quality prediction project report -
#https://ijcat.com/archieve/volume8/issue9/ijcatr08091010.pdf

#https://www.kaggle.com/uciml/red-wine-quality-cortez-et-al-2009

#R rogram
#https://www.kaggle.com/bhaveshthaker/data-analysis-clustering-prediction-modeling
#compare with
#https://www.kaggle.com/numberswithkartik/lets-test-the-wine

#https://towardsdatascience.com/comparing-classification-models-for-wine-quality-prediction-6c5f26669a4f

#https://datauab.github.io/red_wine_quality

#https://www.kaggle.com/jaspritkaur2920/let-s-predict-the-quality
#https://www.kaggle.com/shreenidhi23/wine-quality-predict-basic - no explainations given

#https://www.kaggle.com/artemkostrikin/i-found-the-best-quality-wine -accuracy matrix
#https://www.kaggle.com/abheeshthmishra/overfitting - accuracy graph
#https://www.kaggle.com/hassanamin/exploratory-data-analysis-aka-eda-on-red-wine-data - df['quality'].hist()
#https://www.kaggle.com/paridhimodi/guide-classifing-quality-of-wine - x>7 quality
#https://www.kaggle.com/vgkakad/red-wine-data-analysis-descriptive-predictive

#https://stackoverflow.com/questions/46406720/labelencoder-typeerror-not-supported-between-instances-of-float-and-str


#https://www.youtube.com/watch?v=mnKm3YP56PY - understanding feature scaling (normalization(values compresed to range 0 to 1) and standardization(mean=0,sd=1))
#for ml algo use std normalization
#for dl use minmax normalization

"""Introduction:
The dataset used is Wine Quality Data set from UCI Machine
Learning Repository.The datasets are related
to the Portuguese "Vinho Verde" wine.Due to privacy and logistic issues, only
physicochemical (inputs) and sensory (the output)
variables are available.There is no data about grape
types, wine brand, wine selling price, etc.
Inputs for given data:
1. Fixed Acidity: acid that contributes to the conservation of wine.
2. Volatile Acidity: Amount of acetic acid in wine at high levels can lead to an unpleasant taste of vinegar.
3. Citric Acid: found in small amounts, can add “freshness” and flavor to wines.
4. Residual sugar: amount of sugar remaining after the end of the fermentation.
5. Chlorides: amount of salt in wine.
6.  Free Sulfur Dioxide: it prevents the increase of microbes and the oxidation of the wine.
7. Total Sulfur Dioxide: it shows the aroma and taste of the wine.
8.  Density: density of water, depends on the percentage of alcohol and amount of sugar.
9. pH: describes how acid or basic a wine is on a scale of 0 to 14.
10. Sulfates: additive that acts as antimocrobian and antioxidant.
11. Alcohol: percentage of alcohol present in the wine.

Info about wine:
Red wine is made from dark red and black grapes. The color usually ranges from various shades of red, brown and violet. This is produced with whole grapes including the skin which adds to the color and flavor of red wines, giving it a rich flavor.

White wine is made from white grapes with no skins or seeds. The color is usually straw-yellow, yellow-green, or yellow-gold. Most white wines have a light and fruity flavor as compared to richer red wines

Purpose:
Predict the quality of wine on a scale of 0–10 given a set of features as inputs(fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, free
sulphur dioxide, total sulphur dioxide, density, pH,
sulphates, alcohol) and classification is used to
classify the wine as good or bad.

Exploratory analysis on both the wines: 
Statistical analysis - 
75% of the data consists of white wine remaining 25% is red wine data.Describe function shows that mean value is less than the median value of each column.60% of the data is classified with good wine quality.There were differences in high quality wines when analyzing the density and fixed acidity for red wines and residual sugar and density for white wines.
Correlation matrix plot - There are few features which are correlated.Fixed acidity the best correlation for red wines and residual sugar the best correlation for white wines.
Box plot - Better quality red and white wines have shown decreased level of chlorides and increase in the levels of Citric acid and sulphates.

From the above analysis, good quality red wines have more freshness/flavor and antioxidants in them.

Note:Domain knowledge about wines suggests that we shouldn’t mix them together for classification.

Machine Learning on red wine dataset:
 
Data visualization:
Histogram plot - Horizontal bar represents maximum range of that data and width of box represents spread of that data.Trends found are - 

fixed acidity : No significant effect
volatile acidity : Decreasing
citric acid : Increasing
residual sugar : No significant effect
chlorides : Decreasing
free sulphur dioxide : No significant effect
total sulphur dioxide : No significant effect
sulphates : Increasing
alcohol : Increasing

Correlation matrix plot - Few feature have shown relation with each other(quality,alcohol, sulphates, citric_acid and volatile_acidity).

Machine Learning:
Quality of red wine is distributed in range of (3 to 8).
Quality range and meaning:

0 ==> 3, 4, 5 ==>Bad

1 ==> 6, 7, 8 ==> Good

Normalise the data with standard scaling because different scales of features may impact the performance of the machine learning models.

Random forest classifier model has around 80% accuracy, which is  better than the other models.



Machine learning on white wine dataset:

Data visualization:
Histogram plot - Horizontal bar represents maximum range of that data and width of box represents spread of that data.Trends found are - 

1.   As chlorides level decreases, quality increases
2.  Fixed acidity and sulphates has no impact on Quality
3.  As free sulfur dioxide increases, quality increases

Correlation matrix plot - Few feature have shown relation with each other.
1. PH value has a negative relationship with fixed acidity.
2.  Alcohol has a negative relationship with density, residual sugar, and total sulfur dioxide.
3.  Citric acid and Free Sulfur Dioxide has almost no impact to quality. 
4.  Density has a negative relationship with quality.
5.  Density has a positive relationship with residual sugar.
6.  Alcohol and sulfate have a positive relationship with quality.
7.  Free sulfur and total sulfur also have a positive relationship.

Machine Learning:
Quality of white wine is distributed in range of (3 to 9).
Quality range and meaning:

1 ==> quality (>= 7) as good

0 ==> quality (< 7) as bad

Normalise the data with standard scaling.

Random forest classifier model has around 88% accuracy, which is  better than the other models.


"""

#import the files required
from google.colab import files
import io
upload =files.upload()
for fn in upload.keys():
   print('User uploaded file "{name}" with length {length} bytes'.format(name=fn, length=len(upload[fn])))

# Commented out IPython magic to ensure Python compatibility.
#Load the required libraries 
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
# %matplotlib inline
from matplotlib.ticker import PercentFormatter
import seaborn as sns

#read the data from the file
red_wine = pd.read_csv('winequality-red.csv')
white_wine = pd.read_csv('winequality-white.csv', sep=';')

# store wine type as an attribute
red_wine['wine_type'] = 'red' 
white_wine['wine_type'] = 'white'

#Viewing the data
red_wine.sample(5)

#Viewing the data
white_wine.sample(5)

# bucket wine quality scores into qualitative quality labels

red_wine['quality_label'] = red_wine['quality'].apply(lambda value: 'low' 
                                                          if value <= 5 else 'medium' 
                                                              if value <= 7 else 'high')
red_wine['quality_label'] = pd.Categorical(red_wine['quality_label'], 
                                           categories=['low', 'medium', 'high'])

red_wine.head()

white_wine['quality_label'] = white_wine['quality'].apply(lambda value: 'low' 
                                                              if value <= 5 else 'medium' 
                                                                  if value <= 7 else 'high')
white_wine['quality_label'] = pd.Categorical(white_wine['quality_label'], 
                                             categories=['low', 'medium', 'high'])

white_wine.head()

# merge red and white wine datasets
wines = pd.concat([red_wine, white_wine]) 
# re-shuffle records just to randomize data points
wines = wines.sample(frac=1, random_state=42).reset_index(drop=True)

wines.head()

print(wines.shape)

"""#Statistical analysis"""

data = wines["wine_type"].value_counts(normalize=True)
data.plot(kind='bar',figsize=(7,5))
plt.title("Wine type proportion",fontsize= 16)
plt.gca().yaxis.set_major_formatter(PercentFormatter(1))
plt.show()

"""75% of the data consists of white wine remaining 25% is red wine data."""

wines.describe()

"""Mean value is less than the median value of each column.
There is a large difference between the 75th% tile and max values of residual sugar, free sulfur dioxide & total sulfur dioxide.
"""

subset_attributes = ['alcohol', 'volatile acidity', 'pH', 'quality']
ls = round(wines[wines['quality_label'] == 'low'][subset_attributes].describe(),2)
ms = round(wines[wines['quality_label'] == 'medium'][subset_attributes].describe(),2)
hs = round(wines[wines['quality_label'] == 'high'][subset_attributes].describe(),2)
pd.concat([ls, ms, hs], axis=1, keys=['Low Quality Wine', 'Medium Quality Wine', 'High Quality Wine'])

"""60% of the
data is classified with good wine quality and
40% with bad quality of wine.

"""

subset_attributes = ['residual sugar', 'total sulfur dioxide', 'sulphates', 'alcohol','fixed acidity','volatile acidity', 'quality']
rs = round(red_wine[subset_attributes].describe(),2)
ws = round(white_wine[subset_attributes].describe(),2)

pd.concat([rs, ws], axis=1, keys=['Red Wine Statistics', 'White Wine Statistics'])

"""The distribution of wine quality are similar between the reds and whites. In this sample, there were no evaluations lower than 3 or greater than 9.
Red wine usually is less acid than white wine and opposite is true when we look at volatile_acidity feature. The 'residual_sugar' in average is almost 3 times bigger for a white wine.

#Correlation matrix plot for wines dataset
"""

corr = wines.corr()
sns.heatmap(corr , xticklabels=corr.columns.values , yticklabels=corr.columns.values)
plt.show()

wines.corr()

"""1.   Density has a strong positive correlation with residual sugar, whereas it has a strong negative correlation with alcohol.
2.   Density & fixed acidity has positive correlation.
3.   pH & fixed acidity has negative correlation.
4.   Citric acid & fixed acidity has positive correlation.
5.   Free sulphur dioxide & total sulphur dioxide has positive correlation.
6.   Citric acid & volatile acidity has negative correlation.

#Box plot for wines dataset
"""

fig = plt.figure(figsize=(24,10))
features = ["total sulfur dioxide", "residual sugar", "volatile acidity", "total sulfur dioxide", "chlorides", "fixed acidity", "citric acid","sulphates"]

for i in range(8):
    ax1 = fig.add_subplot(2,4,i+1)
    sns.barplot(x='quality', y=features[i],data=wines, hue='wine_type', palette='rocket')

"""1. The volatile acidity of red wine decreases with better quality.
2. Better quality red and white wines have shown decreased level of chlorides in them, meaning less amount of salt.
3. There is an increase in the levels of Citric acid and sulphates in higher quality of red wine, which could mean that good quality red wines have more freshness/flavor and antioxidants in them.

Observations:It was possible to find subtle differences in high quality wines when analyzing the density and fixed acidity for red wines and residual sugar and density for white wines.It was not clear what differentiates a low quality wine from a medium quality. The few wines classified with low quality may be a limitation of this data set.
"""